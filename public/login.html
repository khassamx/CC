// /server.js (Fragmento de configuración de rutas)
// ... (imports y inicialización de app)

// 1. Configuración del Servidor de Archivos Estáticos
app.use(express.static(path.join(__dirname, 'public')));
// Nota: Tu login.html, chat.html, etc., están en la raíz, NO en 'public'. 
// Esto puede ser un punto de error si los estás sirviendo mal.

// 2. Rutas del Servidor Express
app.get('/', (req, res) => {
    // Si el usuario no está autenticado (no hay sesión)
    // El middleware de sesión debe estar arriba
    if (!req.session || !req.session.user) {
        return res.sendFile(path.join(__dirname, 'login.html')); // Envía el login
    }
    // Si sí está autenticado, redirige al chat
    res.redirect('/chat.html'); 
});

app.get('/chat.html', (req, res) => {
    // Protección de la ruta del chat
    if (!req.session || !req.session.user) {
        return res.redirect('/login.html');
    }
    res.sendFile(path.join(__dirname, 'chat.html'));
});

// ... (otras rutas y arranque)