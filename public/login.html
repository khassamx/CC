<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Login de Acceso</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      display:flex; 
      height:100vh; 
      justify-content:center; 
      align-items:center; 
      background:#111; 
      color:white; 
    }
    .login-box { 
      background:#222; 
      padding:40px; 
      border-radius:15px; 
      text-align:center; 
      box-shadow:0 0 20px rgba(0, 0, 0, 0.5); 
      max-width: 350px;
      width: 90%;
    }
    input { 
      padding:12px 15px; 
      border:none; 
      border-radius:8px; 
      margin-top:20px; 
      text-align:center; 
      font-size:18px;
      width: 100%;
      box-sizing: border-box; 
    }
    h2 { margin-bottom:20px; color: #aaffaa; }
    #mensaje { 
      margin-top:15px; 
      font-weight: bold;
      height: 20px; 
    }
  </style>
</head>
<body>
  <div class="login-box">
    <h2>Ingreso al Chat de Rangos</h2>
    <input type="text" id="usuario" placeholder="Ingresa tu usuario/clave">
    <p id="mensaje">Escribe tu usuario para validar el acceso...</p>
  </div>

  <script>
    const usuarios = {
      // Usamos el nombre y un ID fijo para que el servidor lo rastree
      "oliver": {nombre:"Oliver Doldán", rango:"Fundador", id:"001", foto:"/uploads/default.png"},
      "aye_russu": {nombre:"Aye Russu", rango:"Líder", id:"002", foto:"/uploads/default.png"},
      "atlas": {nombre:"Atlas", rango:"Colíder", id:"003", foto:"/uploads/default.png"},
      "zoe": {nombre:"Zoe", rango:"Veterano", id:"004", foto:"/uploads/default.png"},
      "mili": {nombre:"Mili", rango:"Miembro", id:"005", foto:"/uploads/default.png"}
    };

    const inputUsuario = document.getElementById("usuario");
    const mensaje = document.getElementById("mensaje");
    let isRedirecting = false; 

    inputUsuario.addEventListener("input", () => {
      const valor = inputUsuario.value.trim().toLowerCase();

      if (isRedirecting) return;

      if (usuarios[valor]) {
        const userData = usuarios[valor];
        
        mensaje.textContent = `✔ Usuario válido: [${userData.rango}]. Entrando...`;
        mensaje.style.color = "lightgreen";
        isRedirecting = true;

        // **CRÍTICO:** Guardar datos COMPLETOS en localStorage (se usarán en chat.html y perfil.html)
        localStorage.setItem("perfilUsuario", JSON.stringify({
            usuario: valor,
            nombre: userData.nombre,
            rango: userData.rango,
            id: userData.id,
            foto: localStorage.getItem("perfilUsuario") ? JSON.parse(localStorage.getItem("perfilUsuario")).foto : userData.foto // Mantener foto si ya existe
        }));

        setTimeout(() => {
          window.location.href = "chat.html";
        }, 800);
      } else if (valor.length > 0) {
        mensaje.textContent = "❌ Usuario incorrecto. Intenta de nuevo.";
        mensaje.style.color = "red";
      } else {
        mensaje.textContent = "Escribe tu usuario para validar el acceso...";
        mensaje.style.color = "white";
      }
    });
  </script>
</body>
</html>